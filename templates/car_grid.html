<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Listings</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/car_grid.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <style>
        .car-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); /* Reduced minmax for smaller grid */
            gap: 20px; /* Adjusted gap for smaller grid */
            padding: 20px;
            width: 100%;
            max-width: 1140px;
            margin: 0 auto;
        }

        .car-card {
            border: 1px solid #ddd;
            border-radius: 12px; /* Increased roundness */
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 300px;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .car-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .car-listing {
            display: flex; /* Use flexbox to arrange image and details side-by-side */
            border: 1px solid #ddd;
            margin-bottom: 15px;
            border-radius: 8px;
            overflow: hidden; /* Ensure the image doesn't overflow rounded corners */
        }

        .car-listing img {
            width: 40%; /* Image takes up 40% of the listing width */
            height: auto; /* Maintain aspect ratio */
            display: block; /* Remove any extra space below the image */
            object-fit: cover; /* Cover the area, cropping if necessary */
        }

        .image-slider {
            width: 100%;
            height: 250px;
            overflow: hidden;
            position: relative;
        }

        .image-slider img {
            width: auto;
            height: 100%;
            object-fit: cover;
            display: block;
            margin: auto;
            transition: opacity 0.3s ease;
        }

        .car-tags {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 90%;
            z-index: 2;
        }

        .new-listing-badge,
        .verified-tag {
            background-color: #5cb85c;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            z-index: 10;
            margin-right: auto;
        }

        .just-listed-tag {
            background-color: #f0ad4e;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            z-index: 10;
            margin-left: auto;
        }

        .car-details {
            padding: 15px;
            width: 60%; /* Details take up 60% of the listing width */
        }

        .car-title {
            font-size: 1.2rem;
            margin-bottom: 5px;
            color: #333;
            font-weight: 600;
        }

        .car-price {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #e74c3c;
        }

        .car-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .car-info-item {
            font-size: 0.9rem;
            color: #777;
        }

        .car-specs {
            font-size: 0.9rem;
            color: #777;
        }

        .view-details {
            display: block;
            text-align: center;
            background-color: #007bff;
            color: white;
            padding: 8px 15px;
            border-radius: 4px;
            text-decoration: none;
            transition: background-color 0.2s;
        }

        .view-details:hover {
            background-color: #0056b3;
        }
         /* Mobile Specific Adjustments for Home Page Grid */
        @media (max-width: 768px) {
            .car-grid {
                grid-template-columns: repeat(auto-fit, minmax(45%, 1fr)); /* Min width is still 45% */
                gap: 10px;
                padding: 10px;
            }

            .car-listing {
                flex-direction: column; /* Stack image and details vertically */
            }

            .car-listing img {
                width: 100%; /* Image takes up the full width */
                height: auto;
            }

            .car-details {
                width: 100%; /* Details take up the full width */
            }
        }


        .imageTag {
            width: auto;
            height: 100%;
            object-fit: cover;
            display: block;
            margin: auto;
            transition: opacity 0.3s ease;
        }

    </style>
</head>
<body>
<div class="car-grid">
    {% if cars %}
        {% for car in cars %}
            <div class="car-card car-listing">
                <!-- Image Slider -->
                <div class="image-slider">
                    <div class="swiper-container">
                        <div class="swiper-wrapper">
                            {% if car.images %}
                                {% for image in car.images %}
                                    <div class="swiper-slide">
                                        <img src="{{ image.url }}"
                                             alt="{{ car.title }}"
                                             class="imageTag">
                                    </div>
                                {% endfor %}
                            {% else %}
                                <!-- Default Placeholder Image -->
                                <div class="swiper-slide">
                                    <img src="https://i.imgur.com/placeholder.jpg"
                                         alt="No Image Available"
                                         class="imageTag">
                                </div>
                            {% endif %}
                        </div>
                        {% if car.images|length > 1 %}
                            <div class="swiper-pagination"></div>
                            <div class="swiper-button-prev"></div>
                            <div class="swiper-button-next"></div>
                        {% endif %}
                    </div>

                    <!-- Car tags (badges) moved here -->
                    <div class="car-tags">
                        {% if car.is_approved %}
                            <span class="verified-tag">Verified</span>
                        {% endif %}
                        {% if car.date_posted and (datetime.now(timezone.utc) - car.date_posted).days < 7 %}
                            <span class="just-listed-tag">Just Listed</span>
                        {% endif %}
                    </div>
                </div>

                <!-- Car Details -->
                <div class="car-details">
                    <h5 class="car-title">{{ car.title }}</h5>
                    <p class="car-price">â‚¹{{ "{:,.0f}".format(car.price) }}</p>
                    <div class="car-info">
                        <div>
                            <i class="fas fa-calendar"></i> {{ car.year }}
                        </div>
                        <div>
                            <i class="fas fa-cog"></i> {{ car.transmission or 'N/A' }}
                        </div>
                    </div>
                    <div class="car-location">
                        <i class="fas fa-map-marker-alt"></i>
                        {{ car.city or 'N/A' }}, {{ car.state or 'N/A' }}
                    </div>
                    <div class="car-mileage">
                        <i class="fas fa-tachometer-alt"></i>
                        {{ car.kilometers or 'N/A' }} km
                    </div>
                    <a href="{{ url_for('cars.car', car_id=car.id) }}" class="view-details">View Details</a>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <p>No cars found.</p>
    {% endif %}
</div>

<script>
    var swiper = new Swiper(".swiper-container", {
        loop: true,
        pagination: {
            el: ".swiper-pagination",
            clickable: true,
        },
        navigation: {
            nextEl: ".swiper-button-next",
            prevEl: ".swiper-button-prev",
        },
    });
</script>
</body>
</html>
