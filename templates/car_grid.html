<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Listings</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/car_grid.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <style>
        /* Styles for the Lightweight JavaScript Slider */
        .image-gallery {
            position: relative;
            overflow: hidden;
            height: 200px; /* Adjust as needed */
        }

        .gallery-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.5s ease-in-out;
            opacity: 0;
        }

        .gallery-image.active {
            opacity: 1;
            z-index: 1;
        }

        .prev-button, .next-button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            z-index: 2;
        }

        .prev-button {
            left: 10px;
        }

        .next-button {
            right: 10px;
        }
    </style>
</head>
<body>
    <div class="car-grid">
        {% if cars %}
            {% for car in cars %}
                <div class="car-card">

                    <!-- Image Slider -->
                    <div class="image-slider">
                         <div class="image-gallery">
                            {% if car.images %}
                                {% for image in car.images %}
                                    <img src="{{ image.url }}" alt="{{ car.title }}" class="gallery-image {% if loop.first %}active{% endif %}">
                                {% endfor %}
                            {% else %}
                                <img src="{{ url_for('static', filename='images/default.jpg') }}" alt="No Image Available" class="gallery-image active">
                            {% endif %}

                            <button class="prev-button"><</button>
                            <button class="next-button">></button>
                        </div>

                        <!-- Car tags (badges) moved here -->
                        <div class="car-tags">
                            {% if car.is_approved %}
                                <span class="verified-tag">Verified</span>
                            {% endif %}
                            {% if car.date_posted and (datetime.now(timezone.utc) - car.date_posted).days < 7 %}
                                <span class="just-listed-tag">Just Listed</span>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Car Details -->
                    <div class="car-details">
                        <h5 class="car-title">{{ car.title }}</h5>
                        <p class="car-price">â‚¹{{ "{:,.0f}".format(car.price) }}</p>
                        <div class="car-info">
                            <div>
                                <i class="fas fa-calendar"></i> {{ car.year }}
                            </div>
                            <div>
                                <i class="fas fa-cog"></i> {{ car.transmission or 'N/A' }}
                            </div>
                        </div>
                        <div class="car-location">
                            <i class="fas fa-map-marker-alt"></i>
                            {{ car.city or 'N/A' }}, {{ car.state or 'N/A' }}
                        </div>
                        <div class="car-mileage">
                            <i class="fas fa-tachometer-alt"></i>
                            {{ car.kilometers or 'N/A' }} km
                        </div>
                        <a href="{{ url_for('cars.car', car_id=car.id) }}" class="view-details">View Details</a>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p>No cars found.</p>
        {% endif %}
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const gallery = document.querySelectorAll('.image-gallery');

             gallery.forEach(gallery => {
                const images = gallery.querySelectorAll('.gallery-image');
                const prevButton = gallery.querySelector('.prev-button');
                const nextButton = gallery.querySelector('.next-button');
                let currentIndex = 0;

                function showImage(index) {
                    images.forEach(image => image.classList.remove('active'));
                    images[index].classList.add('active');
                }

                function nextImage() {
                    currentIndex = (currentIndex + 1) % images.length;
                    showImage(currentIndex);
                }

                function prevImage() {
                    currentIndex = (currentIndex - 1 + images.length) % images.length;
                    showImage(currentIndex);
                }

                // Initial image display
                showImage(currentIndex);

                nextButton.addEventListener('click', nextImage);
                prevButton.addEventListener('click', prevImage);

                //Optional: Add autoplay:
                //setInterval(nextImage, 3000);  // Change image every 3 seconds
           });
        });
    </script>
</body>
</html>
